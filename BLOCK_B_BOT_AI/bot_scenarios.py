"""
–°–¶–ï–ù–ê–†–ò–ò –î–ò–ê–õ–û–ì–û–í –î–õ–Ø –ë–û–¢–û–í
–°–æ–≥–ª–∞—Å–Ω–æ –¢–ó: –ë–û–¢-–ü–†–û–í–û–î–ù–ò–ö + AI-–ê–ù–ê–õ–ò–ó
"""

BOT_SCENARIOS = {
    # ==================== –î–õ–Ø –ó–ê–ö–ê–ó–ß–ò–ö–û–í ====================
    'customer_welcome': {
        'message': "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É –∑–∞–≥–æ—Ä–æ–¥–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –î–æ–º–∞-–¶–µ–Ω—ã.–†–§!",
        'description': "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–æ–≤",
        'options': [
            "üè† –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ–º–∞",
            "üî® –†–µ–º–æ–Ω—Ç/–æ—Ç–¥–µ–ª–∫–∞", 
            "üèóÔ∏è –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
            "üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã",
            "‚ùì –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"
        ],
        'next_step': 'project_analysis'
    },
    
    'project_analysis': {
        'description': "–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞",
        'questions': [
            {
                'id': 'region',
                'question': "üìç –í –∫–∞–∫–æ–º —Ä–µ–≥–∏–æ–Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ?",
                'validation': 'not_empty',
                'hint': "–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"
            },
            {
                'id': 'project_type',
                'question': "üèóÔ∏è –ö–∞–∫–æ–π —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
                'validation': 'not_empty',
                'options': [
                    "–ö–∞—Ä–∫–∞—Å–Ω—ã–π –¥–æ–º",
                    "–ö–∏—Ä–ø–∏—á–Ω—ã–π –¥–æ–º",
                    "–†–µ–º–æ–Ω—Ç/–æ—Ç–¥–µ–ª–∫–∞",
                    "–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
                    "–î—Ä—É–≥–æ–µ"
                ]
            },
            {
                'id': 'budget',
                'question': "üí∞ –ü—Ä–∏–º–µ—Ä–Ω—ã–π –±—é–¥–∂–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞?",
                'validation': 'budget_range',
                'hint': "–ù–∞–ø—Ä–∏–º–µ—Ä: 1-3 –º–ª–Ω —Ä—É–±–ª–µ–π, –¥–æ 5 –º–ª–Ω"
            },
            {
                'id': 'timeline',
                'question': "‚è±Ô∏è –ñ–µ–ª–∞–µ–º—ã–µ —Å—Ä–æ–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?",
                'validation': 'not_empty',
                'options': [
                    "–°—Ä–æ—á–Ω–æ (–¥–æ 1 –º–µ—Å—è—Ü–∞)",
                    "–ë—ã—Å—Ç—Ä–æ (1-3 –º–µ—Å—è—Ü–∞)",
                    "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ (3-6 –º–µ—Å—è—Ü–µ–≤)",
                    "–ù–µ —Å—Ä–æ—á–Ω–æ (–±–æ–ª–µ–µ 6 –º–µ—Å—è—Ü–µ–≤)"
                ]
            },
            {
                'id': 'description',
                'question': "üìù –û–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):",
                'validation': 'optional',
                'max_length': 1000
            }
        ],
        'ai_analysis': True,
        'next_step': 'partner_matching'
    },
    
    'partner_matching': {
        'description': "–ü–æ–¥–±–æ—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞",
        'action': "search_partners",
        'criteria': ['region', 'project_type', 'budget', 'timeline'],
        'results_count': 5,
        'presentation': "cards",
        'sort_by': ['rating', 'response_rate', 'completed_projects'],
        'next_step': 'show_results'
    },
    
    # ==================== –î–õ–Ø –ü–ê–†–¢–ù–ï–†–û–í ====================
    'partner_welcome': {
        'message': "üè¢ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–∞—Ä—Ç–Ω–µ—Ä–∞!",
        'description': "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤",
        'options': [
            "üìù –ù–∞—á–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é",
            "‚ÑπÔ∏è –£–∑–Ω–∞—Ç—å —É—Å–ª–æ–≤–∏—è",
            "üíº –£–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
        ],
        'next_step': 'partner_registration'
    },
    
    'partner_registration': {
        'description': "–ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞",
        'steps': [
            {
                'id': 'company_data',
                'title': "–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏",
                'questions': [
                    {
                        'id': 'company_name',
                        'question': "üè¢ –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–∫–∞–∫ –≤ –ï–ì–†–Æ–õ/–ï–ì–†–ò–ü):",
                        'validation': 'not_empty',
                        'max_length': 200
                    },
                    {
                        'id': 'legal_form',
                        'question': "üìã –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—É—é —Ñ–æ—Ä–º—É:",
                        'validation': 'legal_form',
                        'options': ["–û–û–û", "–ò–ü", "–ê–û", "–î—Ä—É–≥–æ–µ"]
                    },
                    {
                        'id': 'inn',
                        'question': "üî¢ –í–≤–µ–¥–∏—Ç–µ –ò–ù–ù –∫–æ–º–ø–∞–Ω–∏–∏ (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä):",
                        'validation': 'inn_format',
                        'hint': "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API –§–ù–°"
                    }
                ]
            },
            {
                'id': 'contact_info',
                'title': "–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                'questions': [
                    {
                        'id': 'contact_person',
                        'question': "üë§ –í–≤–µ–¥–∏—Ç–µ –§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞:",
                        'validation': 'not_empty',
                        'max_length': 100
                    },
                    {
                        'id': 'phone',
                        'question': "üìû –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω:",
                        'validation': 'phone_format',
                        'hint': "–§–æ—Ä–º–∞—Ç: +79991234567"
                    },
                    {
                        'id': 'email',
                        'question': "üìß –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —Å–≤—è–∑–∏:",
                        'validation': 'email_format'
                    },
                    {
                        'id': 'website',
                        'question': "üåê –í–≤–µ–¥–∏—Ç–µ —Å–∞–π—Ç –∫–æ–º–ø–∞–Ω–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å):",
                        'validation': 'optional_url'
                    }
                ]
            },
            {
                'id': 'services_profile',
                'title': "–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ª—É–≥",
                'questions': [
                    {
                        'id': 'main_category',
                        'question': "üéØ –í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
                        'validation': 'category',
                        'options': [
                            "–ü–æ–¥—Ä—è–¥—á–∏–∫ (—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ–º–æ–Ω—Ç)",
                            "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å (–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π)",
                            "–ü—Ä–æ–¥–∞–≤–µ—Ü (—Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è)",
                            "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã)"
                        ]
                    },
                    {
                        'id': 'specializations',
                        'question': "üîß –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):",
                        'validation': 'multiple_choice',
                        'options': [
                            "–ö–∞—Ä–∫–∞—Å–Ω—ã–µ –¥–æ–º–∞",
                            "–ö–∏—Ä–ø–∏—á–Ω—ã–µ –¥–æ–º–∞",
                            "–û—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
                            "–ö—Ä–æ–≤–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
                            "–§—É–Ω–¥–∞–º–µ–Ω—Ç—ã",
                            "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂",
                            "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞",
                            "–û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏",
                            "–û—Ç–æ–ø–ª–µ–Ω–∏–µ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è",
                            "–õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω"
                        ],
                        'max_selections': 5
                    }
                ]
            },
            {
                'id': 'geography',
                'title': "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Ä–∞–±–æ—Ç—ã",
                'questions': [
                    {
                        'id': 'regions',
                        'question': "üó∫Ô∏è –í –∫–∞–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?",
                        'validation': 'multiple_choice',
                        'options': [
                            "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π",
                            "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω",
                            "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
                            "–î—Ä—É–≥–∏–µ —Ä–µ–≥–∏–æ–Ω—ã"
                        ]
                    },
                    {
                        'id': 'cities',
                        'question': "üèôÔ∏è –í –∫–∞–∫–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç–µ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)?",
                        'validation': 'optional',
                        'hint': "–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –°–æ—á–∏"
                    },
                    {
                        'id': 'radius_km',
                        'question': "üìè –†–∞–¥–∏—É—Å —Ä–∞–±–æ—Ç—ã –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ (–≤ –∫–º):",
                        'validation': 'number',
                        'default': 50,
                        'min': 10,
                        'max': 500
                    }
                ]
            },
            {
                'id': 'pricing',
                'title': "–¶–µ–Ω—ã –∏ —É—Å–ª–æ–≤–∏—è",
                'questions': [
                    {
                        'id': 'price_type',
                        'question': "üí∞ –¢–∏–ø —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:",
                        'validation': 'single_choice',
                        'options': [
                            "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –ø—Ä–æ–µ–∫—Ç",
                            "–¶–µ–Ω–∞ –∑–∞ –º¬≤/–º¬≥",
                            "–ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞",
                            "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Å–º–µ—Ç–∞",
                            "–î—Ä—É–≥–æ–µ"
                        ]
                    },
                    {
                        'id': 'price_examples',
                        'question': "üíµ –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30 000 —Ä—É–±/–º¬≤):",
                        'validation': 'optional',
                        'max_length': 500
                    },
                    {
                        'id': 'min_order',
                        'question': "üì¶ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (—Ä—É–±):",
                        'validation': 'optional_number',
                        'hint': "–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ—Ç –º–∏–Ω–∏–º—É–º–∞"
                    }
                ]
            }
        ],
        'next_step': 'verification'
    },
    
    'verification': {
        'description': "–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞",
        'message': "‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã! –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é.",
        'steps': [
            "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–û–ì–†–ù, –ò–ù–ù, –≤—ã–ø–∏—Å–∫–∞ –ï–ì–†–Æ–õ)",
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API –§–ù–°",
            "–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)",
            "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞"
        ],
        'next_step': 'completion'
    },
    
    'completion': {
        'description': "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        'message': "üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é.",
        'actions': [
            {
                'text': "üìã –ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç",
                'url': "https://–ø–∞—Ä—Ç–Ω–µ—Ä.–¥–æ–º–∞-—Ü–µ–Ω—ã.—Ä—Ñ"
            },
            {
                'text': "üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π",
                'action': "contact_support"
            },
            {
                'text': "üí∞ –í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ",
                'action': "select_tariff"
            }
        ]
    },
    
    # ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –õ–ò–î–ê–ú–ò ====================
    'lead_management': {
        'description': "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤",
        'notifications': {
            'new_lead': "üîî –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞!",
            'lead_accepted': "‚úÖ –í—ã –ø—Ä–∏–Ω—è–ª–∏ –∑–∞—è–≤–∫—É",
            'lead_declined': "‚ùå –í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –∑–∞—è–≤–∫—É",
            'reminder': "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –∑–∞—è–≤–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤"
        },
        'actions': [
            {
                'id': 'accept_lead',
                'text': "–ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É",
                'icon': "‚úÖ"
            },
            {
                'id': 'decline_lead',
                'text': "–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É",
                'icon': "‚ùå"
            },
            {
                'id': 'schedule_call',
                'text': "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫",
                'icon': "üìÖ"
            },
            {
                'id': 'request_details',
                'text': "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–µ—Ç–∞–ª–∏",
                'icon': "‚ùì"
            }
        ]
    }
}

def get_scenario(scenario_name, step_id=None):
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –∏–º–µ–Ω–∏"""
    scenario = BOT_SCENARIOS.get(scenario_name)
    
    if not scenario:
        return None
    
    # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥
    if step_id and 'steps' in scenario:
        for step in scenario['steps']:
            if step.get('id') == step_id:
                return step
    
    return scenario

def get_next_step(scenario_name, current_step_id=None):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ —Å—Ü–µ–Ω–∞—Ä–∏—è"""
    scenario = get_scenario(scenario_name)
    
    if not scenario:
        return None
    
    if current_step_id and 'steps' in scenario:
        steps = scenario['steps']
        for i, step in enumerate(steps):
            if step.get('id') == current_step_id and i < len(steps) - 1:
                return steps[i + 1]
    
    return scenario.get('next_step')

def validate_input(input_text, validation_type, **kwargs):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if not input_text and validation_type != 'optional':
        return False, "–ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    
    if validation_type == 'not_empty':
        if not input_text.strip():
            return False, "–ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
        return True, None
    
    elif validation_type == 'inn_format':
        if not input_text.isdigit() or len(input_text) not in [10, 12]:
            return False, "–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä"
        return True, None
    
    elif validation_type == 'phone_format':
        import re
        pattern = r'^(\+7|7|8)?[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$'
        if not re.match(pattern, input_text):
            return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
        return True, None
    
    elif validation_type == 'email_format':
        import re
        pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        if not re.match(pattern, input_text):
            return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"
        return True, None
    
    elif validation_type == 'budget_range':
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –±—é–¥–∂–µ—Ç–∞
        if '–º–ª–Ω' in input_text.lower() or '—Ç—ã—Å' in input_text.lower():
            return True, None
        if any(char.isdigit() for char in input_text):
            return True, None
        return False, "–£–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç –≤ —Ä—É–±–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1-3 –º–ª–Ω)"
    
    return True, None
